<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate (personalised) thresholds based on CIPs. — prepare_thresholds • LTFGRS</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate (personalised) thresholds based on CIPs. — prepare_thresholds"><meta name="description" content="This function prepares input for estimate_liability by calculating thresholds based on stratified cumulative incidence proportions (CIPs) with options for interpolation for ages between CIP values. Given a tibble with families and family members and (stratified) CIPs, personalised thresholds will be calculated for each individual present in .tbl. An individual may be in multiple families, but only once in the same family."><meta property="og:description" content="This function prepares input for estimate_liability by calculating thresholds based on stratified cumulative incidence proportions (CIPs) with options for interpolation for ages between CIP values. Given a tibble with families and family members and (stratified) CIPs, personalised thresholds will be calculated for each individual present in .tbl. An individual may be in multiple families, but only once in the same family."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LTFGRS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/LTFGRS_workflow_prediction.html">LTFGRS Workflow: Prepare Genetic Liability for Prediction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EmilMiP/LTFGRS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate (personalised) thresholds based on CIPs.</h1>
      <small class="dont-index">Source: <a href="https://github.com/EmilMiP/LTFGRS/blob/main/R/Prepare_Graph_Input.R" class="external-link"><code>R/Prepare_Graph_Input.R</code></a></small>
      <div class="d-none name"><code>prepare_thresholds.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function prepares input for <code>estimate_liability</code> by calculating thresholds based on stratified cumulative incidence proportions (CIPs) with options for interpolation for ages between CIP values. Given a tibble with families and family members and (stratified) CIPs, personalised thresholds will be calculated for each individual present in <code>.tbl</code>. An individual may be in multiple families, but only once in the same family.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prepare_thresholds</span><span class="op">(</span></span>
<span>  <span class="va">.tbl</span>,</span>
<span>  <span class="va">CIP</span>,</span>
<span>  <span class="va">age_col</span>,</span>
<span>  CIP_merge_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"birth_year"</span>, <span class="st">"age"</span><span class="op">)</span>,</span>
<span>  CIP_cip_col <span class="op">=</span> <span class="st">"cip"</span>,</span>
<span>  status_col <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  lower_equal_upper <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  personal_thr <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fid_col <span class="op">=</span> <span class="st">"fid"</span>,</span>
<span>  personal_id_col <span class="op">=</span> <span class="st">"pid"</span>,</span>
<span>  interpolation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bst.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_depth <span class="op">=</span> <span class="fl">10</span>, base_score <span class="op">=</span> <span class="fl">0</span>, nthread <span class="op">=</span> <span class="fl">4</span>, min_child_weight <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  min_CIP_value <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  xgboost_itr <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--tbl">.tbl<a class="anchor" aria-label="anchor" href="#arg--tbl"></a></dt>
<dd><p>Tibble with  family and personal id columns, as well as CIP_merge_columns and status.</p></dd>


<dt id="arg-cip">CIP<a class="anchor" aria-label="anchor" href="#arg-cip"></a></dt>
<dd><p>Tibble with population representative cumulative incidence proportions. CIP must contain columns from <code>CIP_merge_columns</code> and <code>cIP_cip_col</code>.</p></dd>


<dt id="arg-age-col">age_col<a class="anchor" aria-label="anchor" href="#arg-age-col"></a></dt>
<dd><p>Name of column with age at the end of follow-up or age at diagnosis for cases.</p></dd>


<dt id="arg-cip-merge-columns">CIP_merge_columns<a class="anchor" aria-label="anchor" href="#arg-cip-merge-columns"></a></dt>
<dd><p>The columns the CIPs are subset by, e.g. CIPs by birth_year, sex.</p></dd>


<dt id="arg-cip-cip-col">CIP_cip_col<a class="anchor" aria-label="anchor" href="#arg-cip-cip-col"></a></dt>
<dd><p>Name of column with CIP values.</p></dd>


<dt id="arg-status-col">status_col<a class="anchor" aria-label="anchor" href="#arg-status-col"></a></dt>
<dd><p>Column that contains the status of each family member. Coded as 0 or FALSE (control) and 1 or TRUE (case).</p></dd>


<dt id="arg-lower-equal-upper">lower_equal_upper<a class="anchor" aria-label="anchor" href="#arg-lower-equal-upper"></a></dt>
<dd><p>Should the upper and lower threshold be the same for cases? Can be used if CIPs are detailed, e.g. stratified by birth year and sex.</p></dd>


<dt id="arg-personal-thr">personal_thr<a class="anchor" aria-label="anchor" href="#arg-personal-thr"></a></dt>
<dd><p>Should thresholds be based on stratified CIPs or population prevalence?</p></dd>


<dt id="arg-fid-col">fid_col<a class="anchor" aria-label="anchor" href="#arg-fid-col"></a></dt>
<dd><p>Column that contains the family ID.</p></dd>


<dt id="arg-personal-id-col">personal_id_col<a class="anchor" aria-label="anchor" href="#arg-personal-id-col"></a></dt>
<dd><p>Column that contains the personal ID.</p></dd>


<dt id="arg-interpolation">interpolation<a class="anchor" aria-label="anchor" href="#arg-interpolation"></a></dt>
<dd><p>Type of interpolation, defaults to NULL.</p></dd>


<dt id="arg-bst-params">bst.params<a class="anchor" aria-label="anchor" href="#arg-bst-params"></a></dt>
<dd><p>List of parameters to pass on to xgboost. See xgboost documentation for details.</p></dd>


<dt id="arg-min-cip-value">min_CIP_value<a class="anchor" aria-label="anchor" href="#arg-min-cip-value"></a></dt>
<dd><p>Minimum cip value to allow. Too low values may lead to numerical instabilities.</p></dd>


<dt id="arg-xgboost-itr">xgboost_itr<a class="anchor" aria-label="anchor" href="#arg-xgboost-itr"></a></dt>
<dd><p>Number of iterations to run xgboost for.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Tibble with (personlised) thresholds for each family member (lower &amp; upper), the calculated cumulative incidence proportion for each individual (K_i), and population prevalence within an individuals CIP strata (K_pop; max value in stratum). The threshold and other potentially relevant information can be added to the family graphs with <code>familywise_attach_attributes</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">tbl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>fid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>pid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>role <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"o"</span>, <span class="st">"m"</span>, <span class="st">"f"</span>, <span class="st">"pgf"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">42</span>, <span class="fl">48</span>, <span class="fl">78</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>birth_year <span class="op">=</span> <span class="fl">2023</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">42</span>, <span class="fl">48</span>, <span class="fl">78</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>aoo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">43</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cip</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">42</span>, <span class="fl">43</span>, <span class="fl">45</span>, <span class="fl">48</span>, <span class="fl">78</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>birth_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">1981</span>, <span class="fl">1975</span>, <span class="fl">1945</span>, <span class="fl">1975</span>, <span class="fl">1945</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>cip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">prepare_thresholds</span><span class="op">(</span>.tbl <span class="op">=</span> <span class="va">tbl</span>, CIP <span class="op">=</span> <span class="va">cip</span>, age_col <span class="op">=</span> <span class="st">"age"</span>, interpolation <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fid pid role sex status age birth_year aoo cip       thr     lower     upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1   1    o   1      0  22       2001  NA 0.1 1.2815516      -Inf 1.2815516</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   1   2    m   0      0  42       1981  NA 0.2 0.8416212      -Inf 0.8416212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   1   3    f   1      1  48       1975  43 0.3 0.5244005 0.5244005       Inf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   1   4  pgf   1      1  78       1945  45 0.4 0.2533471 0.2533471       Inf</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emil Michael Pedersen, Jette Steinbach.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

